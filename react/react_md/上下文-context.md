<!--
 * @Author: lihaoran
 * @Date: 2020-01-02 17:42:41
 * @LastEditTime : 2020-01-03 14:04:41
 * @LastEditors  : Please set LastEditors
 * @Description: lihaoran
 * @FilePath: \learn\react\react_md\上下文-context.md
 -->
# context

上下文：Context，表示做某一些事情的环境

React 中的上下文的特点
1. 当某个组件创建了上下文后，上下文中的数据，会被所有后台组件共享
2. 如果某个组件依赖了上下文，会导致该组件不在纯粹（指数据的来源于传入的数据）
3. 一般用于第三方组件（通用组件）

## 旧的API

只有类组件才可以创建上下文（函数组件也可以，但是认为函数组件没有状态，一般来说上下文来自于状态）
1. 给类组件书写静态属性 childContextTypes ，使用该属性对上下文中的数据类型进行约束

**使用上下文中的数据**

要求：如果使用上下文中的数据，组件必须有一个静态属性 contextTypes，该属性描述了需要获取的上下文中的数据类型

1. 可以再组建的构造函数中，可以在构造函数的第二个参数中获取到上下文的数据
2. 从组件的context属性中获取
3. 上下文中的数据不可以直接变化，最终都是通过状态改变
4. 在上下文中加入一个处理函数，可以用后代组件更新


## 新的API

**创建上下文**

上下文是独立于组件的对象，该对象通过React.createContext(默认值)创建返回的是一个包含两个属性的对象
1. Provider属性：生产者。一个组件，该组件会创建一个上下文，该组件有一个value属性，通过该属性，可以为其数据赋值
    1. 同一个Provider，不要用到多个组件中，如果需要在其他组件中使用改数据，应该考虑将数据提升至更高层次（即定义生产者时，定义到更高层的组件中）
2. Consumer属性：

**使用上下文中的数据**

1. 在类组建中，直接使用this.context获取上下文数据
    1. 要求：必须拥有静态属性 contextType，应付职位创建的上下文对象
2. 在函数组建中，需要使用Consumer来获取上下文数据
    1. Consumer是一个组件
    2. 他的子节点，是一个函数 （他的Props.children需要传递一个函数）

**注意细节**

如果，上下文提供者（context.Provider）中的Value属性发生变化，会导致该上下文提供的所有后代元素全部重新渲染，无论该子元素是否有优化（should）
想要优化上述问题 则需要在让state等于一个索引地址固定不变的对象（内部判断原理是用Object.is 去比对两个对象是否发生了变化（甚至是索引地址的变化））
例：
    定义：
    state = {
        ctx:{
            a:0,
            b:"111"
        }
    }
    使用：
    this.state.ctx.a
    则可以避免在状态未发生变化时 重新渲染的问题
